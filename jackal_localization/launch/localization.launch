<?xml version="1.0"?>
<launch>

<!-- Combine Laser -->
<node pkg="ira_laser_tools" name="laserscan_multi_merger" type="laserscan_multi_merger" output="screen">
  <param name="destination_frame" value="base_link"/>
  <param name="scan_destination_topic" value="/scan_combined"/>
  <param name="laserscan_topics" value="/scan_front /scan_back" /> <param name="angle_min" value="-3.14159"/>
  <param name="angle_max" value="3.14159"/>
  
  <param name="angle_increment" value="0.0058"/> <param name="scan_time" value="0.0333333"/>
  <param name="range_min" value="0.10"/>
  <param name="range_max" value="30.0"/>
</node>


<!-- Depth -->
<node pkg="tf" type="static_transform_publisher" name="camera_optical_broadcaster" 
      args="0 0 0 -1.5708 0 -1.5708 camera_link camera_depth_optical_frame 10" />

<node pkg="rtabmap_odom" type="icp_odometry" name="icp_vo" output="screen">

  <remap from="odom" to="/odom/depth"/>
  <remap from="scan_cloud" to="/camera/depth/points"/>
  
  <param name="frame_id" value="base_link"/>
  <param name="odom_frame_id" value="odom"/>
  <param name="publish_tf" value="false"/>
  
  <param name="Icp/PointToPlane"  value="true"/>
  <param name="Icp/VoxelSize"     value="0.05"/>

  <param name="guess_frame_id" value=""/> 
  <param name="subscribe_odom" value="false"/>

  <param name="Odom/ResetCountdown" value="1"/>
  <param name="wait_for_transform_duration" value="0.2"/>

  <param name="initial_pose" value="-5.0 -4.0 0.0 0 0 0.0"/>
</node>


<!-- RGB -->
<node pkg="rtabmap_odom" type="rgbd_odometry" name="visual" output="screen">

  <remap from="rgb/image" to="/camera/color/image_raw"/>
  <remap from="depth/image" to="/camera/depth/image_raw"/> 
  <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
  
  <remap from="odom" to="/odom/visual"/>

  <param name="frame_id" value="base_link"/> 
  <param name="odom_frame_id" value="odom"/> 
  <param name="publish_tf" value="false"/>

  <param name="subscribe_depth" value="true"/>
  <param name="subscribe_odom" value="false"/>

  <param name="initial_pose" value="-5.0 -4.0 0.0 0 0 0.0"/>
</node>



<!-- Scan Matching -->
<node pkg="laser_scan_matcher" type="laser_scan_matcher_node" name="laser_scan_matcher_node" output="screen">
  <param name="tf_tolerance" value="0.1"/>
  <!-- <remap from="scan" to="/scan_combined"/> -->
  <!-- <remap from="scan" to="/scan_front"/> -->
  <!-- <remap from="scan" to="/scan_back"/> -->
  <remap from="scan" to="/depth/scan"/>

  <param name="fixed_frame" value="odom"/>
  <param name="base_frame" value="base_link"/>

  <param name="publish_tf" value="false"/>
  <param name="publish_pose" value="true"/>
  <param name="publish_pose_stamped" value="true"/>
  <param name="publish_pose_with_covariance_stamped" value="true"/>
</node>



<node name="wheel_odom" pkg="jackal_localization" type="wheel_odom.py" output="screen"></node>

<node pkg="robot_localization" type="ekf_localization_node" name="ekf_custom" clear_params="true">
  <remap from="odometry/filtered" to="/odom/filtered"/>
  <rosparam command="load" file="$(find jackal_localization)/params/ekf_params.yaml" />
</node>

<!-- <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_map" clear_params="true">
  <remap from="odometry/filtered" to="odometry/filtered_map"/>
</node> -->
<!-- <node name="odom_to_map" pkg="tf" type="static_transform_publisher" args="-0.1 0.1 0.0 0.0 0.0 0 map odom 200" /> -->


</launch>
